#!/bin/bash

CURRENT_VERSION=$(./bin/currentversion)
NEXT_VERSION=$(./bin/nextversion)

echo "Updating mix.exs from ${CURRENT_VERSION} to ${NEXT_VERSION}"
sed -i '' "s/$CURRENT_VERSION/$NEXT_VERSION/g" mix.exs

NEW_VERSION=$(./bin/currentversion)

if [ "${NEW_VERSION}" != "${NEXT_VERSION}" ]; then
  echo "Unable to update version, stopping script"
  exit 1
fi

(git add mix.exs && \
 git commit -m "v${NEW_VERSION}" && \
 git tag "v${NEW_VERSION}" && \
 git push && \
 git push --tag && \
 mix hex.publish)